<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"  [ ]>

<chapter id="ejb-jaxrs-resource">
    <title></title>
    <subtitle>Resources, URIs, Methods, Content, and Status Codes</subtitle>



    <section id="ejb-jaxrs-resource-jaxrsclass">
        <title>JAX-RS Resource Class</title>
        <itemizedlist spacing="compact">
            <listitem><para>Annotated with @Path</para></listitem>
            <listitem><para>Injected with implementation details and call context</para></listitem>
        </itemizedlist>                   
<programlisting language="java"><![CDATA[
@Path("/products")
public class ProductsResource {
    private static final Log log = LogFactory.getLog(ProductsResource.class);
    @Inject
    private InventoryMgmtEJB ejb;
    @Context
    private Request request;
    @Context 
    private UriInfo uriInfo;
    ...
]]></programlisting>
        
        <section id="ejb-jaxrs-resource-jaxrsclass-post">
            <title>JAX-RS Resource POST Method</title>
            <itemizedlist spacing="compact">
                <listitem><para>Create new resource or tunnel service</para></listitem>
                <listitem><para>Returns CREATED and URO of created resource</para></listitem>
            </itemizedlist>                   
<programlisting language="java"><![CDATA[
@POST @Path("")
@Consumes(MediaType.APPLICATION_XML)
@Produces(MediaType.APPLICATION_XML)
public Response addCustomer(Customer customer) {
    log.debug(String.format("%s %s", request.getMethod(), uriInfo.getAbsolutePath()));
    try {
        Customer c = ejb.addCustomer(customer);
        URI uri = UriBuilder.fromUri(uriInfo.getAbsolutePath())
                .path(CustomersResource.class, "getCustomer")
                .build(c.getId());
        return Response.created(uri)
                .entity(c)
                .build();
    } catch (Exception ex) {
        return serverError(log, "creating person", ex).build();
    }
}
]]></programlisting>
        </section>
        
        

        <section id="ejb-jaxrs-resource-jaxrsclass-get">
            <title>JAX-RS GET Resource Method</title>
            <itemizedlist spacing="compact">
                <listitem><para>Non-destructive read</para></listitem>
                <listitem><para>Returns OK with payload</para></listitem>
            </itemizedlist>                   
<programlisting language="java"><![CDATA[
@GET @Path("{id}")
@Produces(MediaType.APPLICATION_XML)
public Response getProduct(@PathParam("id")int id) {
    log.debug(String.format("%s %s", request.getMethod(), uriInfo.getAbsolutePath()));

    try {
        Product product = ejb.getProduct(id);
        if (product != null) {
            return Response.ok(product)
                    .build();
        }
        else {
            return Response.status(Response.Status.NOT_FOUND)
                    .entity(String.format("unable to locate product %d", id))
                    .type(MediaType.TEXT_PLAIN)
                    .build();
        }
    } catch (Exception ex) {
        return ResourceHelper.serverError(log, "getting product", ex).build();
    }
}
]]></programlisting>
        </section>

        <section id="ejb-jaxrs-resource-jaxrsclass-put">
            <title>JAX-RS PUT Resource Method</title>
            <itemizedlist spacing="compact">
                <listitem><para>Create new or update existing</para></listitem>
                <listitem><para>Optional results</para></listitem>
            </itemizedlist>                   
<programlisting language="java"><![CDATA[
    @PUT @Path("{id}")
    @Consumes(MediaType.APPLICATION_XML)
    @Produces(MediaType.APPLICATION_XML)
    public Response updateProduct(@PathParam("id") int id, Product product) {
        log.debug(String.format("%s %s", request.getMethod(), uriInfo.getAbsolutePath()));

        try {
            Product p = ejb.updateProduct(product);
            return Response.ok(p)
                    .build();
        } catch (Exception ex) {
            return ResourceHelper.serverError(log, "update product", ex).build();
        }
    }
]]></programlisting>
        </section>


        <section id="ejb-jaxrs-resource-jaxrsclass-delete">
            <title>JAX-RS DELETE Resource Method</title>
            <itemizedlist spacing="compact">
                <listitem><para>Deletes specified resource</para></listitem>
                <listitem><para>Optional results</para></listitem>
            </itemizedlist>                   
<programlisting language="java"><![CDATA[
@DELETE @Path("{id}")
@Produces(MediaType.APPLICATION_XML)
public Response deleteCustomer(@PathParam("id") int id) {
    log.debug(String.format("%s %s", request.getMethod(), uriInfo.getAbsolutePath()));
    try {
        ejb.deleteCustomer(id);
        return Response.ok()
                .build();
    } catch (Exception ex) {
        return serverError(log, "deleting person", ex).build();
    }
}
]]></programlisting>
        </section>
    </section>

        <section id="ejb-jaxrs-resource-http">
        <title>HTTP Request/Response</title>
        <itemizedlist spacing="compact">
            <listitem><para>Request supplies method, URI, optional payload, and other properties</para></listitem>
        </itemizedlist>                   
<programlisting language=""><![CDATA[
GET /jaxrsInventoryWAR/rest/categories?name=snacks&offset=0&limit=0 HTTP/1.1
Accept: application/xml
Host: 127.0.0.1:7080
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.3 (java 1.5)
]]></programlisting>

        <itemizedlist spacing="compact">
            <listitem><para>Response provides status code, optional entity, and other properties]</para></listitem>
        </itemizedlist>                   
<programlisting language=""><![CDATA[
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: application/xml
Transfer-Encoding: chunked
Date: Tue, 06 Nov 2012 07:32:18 GMT

<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:catageories xmlns:ns2="http://webejb.ejava.info/inventory" count="1" limit="0" offset="0" version="0">
    <categories id="4" name="snacks" version="1">
        <productCount>1</productCount>
    </categories>
</ns2:catageories>
]]></programlisting>
    </section>


</chapter>
  
